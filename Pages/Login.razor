@page "/login"
@inject NavigationManager Nav
@inject MoneyApp.Services.AuthService Auth

<h3>Connexion</h3>

<div style="max-width:420px">
    <label>Email</label>
    <input class="form-control" @bind="Email" />

    <label class="mt-2">Mot de passe</label>
    <input type="password" class="form-control" @bind="Password" />

    <button class="btn btn-primary mt-3" @onclick="Connect" disabled="@Loading">
        @(Loading ? "Connexion..." : "Se connecter")
    </button>

    @if (!string.IsNullOrWhiteSpace(Error))
    {
        <div class="alert alert-danger mt-3">@Error</div>
    }
</div>

@code {
    private string Email = "";
    private string Password = "";
    private bool Loading;
    private string? Error;

    private async Task Connect()
    {
        Error = null;
        Loading = true;

        try
        {
            var (ok, error) = await Auth.LoginAsync(Email, Password);
            if (!ok)
            {
                Error = error ?? "Identifiants invalides.";
                return;
            }

            Nav.NavigateTo("/consultation");
        }
        finally
        {
            Loading = false;
        }
    }
}
